language: cxx

services:
  - docker

git:
  clone: false

env: STAR_CVS_REF=master

before_install:
  - echo "STAR_CVS_REF=$STAR_CVS_REF"
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce
  - docker --version
  - docker pull starbnl/star-sw:latest-build
  - docker images
  - docker build -t starbnl/star-sw:latest-build --build-arg STAR_CVS_REF=$STAR_CVS_REF --build-arg STAR_BUILD_TYPE=Release --build-arg STAR_BASE_IMAGE=starbnl/star-base:centos7 --build-arg STAR_SW_REF=master --target build-stage --cache-from starbnl/star-sw:latest-build .

script: true
